let coinScene,coinCamera,coinRenderer,coinLogo,jarScene,jarCamera,jarRenderer,jar,resizeTimeout,droppedCoins=[];function initCoinScene(){const e=document.getElementById("coin-canvas");coinScene=new THREE.Scene,coinScene.background=null,coinCamera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,5e3),coinCamera.position.set(0,0,1e3),coinRenderer=new THREE.WebGLRenderer({canvas:e,alpha:!0}),coinRenderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),coinRenderer.setSize(window.innerWidth,window.innerHeight,!1);(new THREE.GLTFLoader).load("https://cdn.jsdelivr.net/gh/kevindakin/penny-jar@v1.1/logo.glb",(e=>{coinLogo=e.scene.getObjectByName("CoinLogo"),coinLogo.traverse((e=>{if(e.isMesh){const o=new THREE.EdgesGeometry(e.geometry,40),n=new THREE.LineSegments(o,new THREE.LineBasicMaterial({color:16249069,transparent:!0,opacity:1,depthTest:!1,depthWrite:!1}));n.renderOrder=999,e.add(n),e.material=new THREE.MeshBasicMaterial({transparent:!0,opacity:0,depthWrite:!1,depthTest:!1,colorWrite:!1})}})),setCoinInitialTransform(),coinScene.add(coinLogo),renderCoin(),initScrollAnimations()}))}function initJarScene(){const e=document.getElementById("jar-canvas");jarScene=new THREE.Scene,jarScene.background=null;const o=window.innerWidth/window.innerHeight,n=1e3;jarCamera=new THREE.OrthographicCamera(n*o/-2,n*o/2,500,-500,.1,5e3),jarCamera.position.set(0,0,1e3),jarRenderer=new THREE.WebGLRenderer({canvas:e,alpha:!0}),jarRenderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),jarRenderer.setSize(window.innerWidth,window.innerHeight,!1);(new THREE.GLTFLoader).load("https://cdn.jsdelivr.net/gh/kevindakin/penny-jar@v1.11/jar.glb",(e=>{jar=e.scene.getObjectByName("Jar"),jar.traverse((e=>{if(e.isMesh){const o=new THREE.EdgesGeometry(e.geometry,40),n=new THREE.LineSegments(o,new THREE.LineBasicMaterial({color:16249069,opacity:1,transparent:!0,depthTest:!1,depthWrite:!1}));n.renderOrder=999,e.add(n),e.material=new THREE.MeshBasicMaterial({transparent:!0,opacity:0,depthWrite:!1,depthTest:!1,colorWrite:!1})}}));const o=new THREE.LineBasicMaterial({color:16249069,transparent:!0,opacity:.8,depthTest:!1,depthWrite:!1}),n=[new THREE.Vector3(-163,45,0),new THREE.Vector3(-163,366,0)],r=[new THREE.Vector3(163,45,0),new THREE.Vector3(163,366,0)],t=(new THREE.BufferGeometry).setFromPoints(n),i=(new THREE.BufferGeometry).setFromPoints(r),a=new THREE.Line(t,o.clone()),s=new THREE.Line(i,o.clone());jar.add(a),jar.add(s),jar.position.set(0,-275,0),jar.scale.set(1.5,1.5,1.5),jar.rotation.set(.15,-.2,0),jarScene.add(jar),renderJar(),window.innerWidth<992?(gsap.to("#jar-canvas",{opacity:0,scrollTrigger:{trigger:".home_centered_section",start:"top top",end:"center+=200 top",scrub:!0}}),gsap.to("#coin-canvas",{opacity:0,scrollTrigger:{trigger:".home_centered_section",start:"top top",end:"center top",scrub:!0}})):(gsap.to(jar.position,{x:-440,y:-440,scrollTrigger:{trigger:".home_testimonials_section",start:"top bottom",end:"center top",scrub:!0,onUpdate:renderJar}}),gsap.to(jar.scale,{x:1.7,y:1.7,z:1.7,scrollTrigger:{trigger:".home_testimonials_section",start:"top bottom",end:"center top",scrub:!0,onUpdate:renderJar}}),gsap.set({},{scrollTrigger:{trigger:".home_testimonials_section",start:"top bottom",end:"bottom top",onLeave:()=>clearDroppedCoins(),onLeaveBack:()=>clearDroppedCoins()}}))}))}function dropCoin(){if(!coinLogo||!jar)return;if(droppedCoins.length>0){droppedCoins[droppedCoins.length-1].traverse((e=>{e.isLine&&gsap.to(e.material,{opacity:0,duration:.8,onUpdate:renderJar})}))}const e=coinLogo.clone(!0);e.traverse((e=>{(e.isMesh||e.isLine)&&(e.material=e.material.clone())})),e.position.set(50*(Math.random()-.5),400,0),e.rotation.set(0,0,0),e.scale.set(.4,.4,.4),jar.add(e),droppedCoins.push(e),gsap.to(e.position,{y:50+50*Math.random(),duration:2,ease:"bounce.out",onUpdate:renderJar}),gsap.to(e.rotation,{x:2.6*Math.PI,y:2*Math.PI,duration:2,ease:"power2.out",onUpdate:renderJar})}function clearDroppedCoins(){droppedCoins.forEach((e=>{e.traverse((o=>{o.isLine&&gsap.to(o.material,{opacity:0,duration:.3,onUpdate:renderJar,onComplete:()=>jar.remove(e)})}))})),droppedCoins.length=0}function initSwiperDrops(e){window.innerWidth<992||setTimeout((()=>{e.on("slideChange",(()=>{coinLogo&&dropCoin()}))}),200)}function setCoinInitialTransform(){if(!coinLogo)return;const e=window.innerWidth;e<768?(coinLogo.position.set(120,-70,0),coinLogo.scale.set(1.4,1.4,1.4),coinLogo.rotation.set(.4,0,-.1)):e<992?(coinLogo.position.set(220,-15,0),coinLogo.scale.set(1.8,1.8,1.8),coinLogo.rotation.set(.4,0,-.1)):(coinLogo.position.set(340,-30,0),coinLogo.scale.set(2.5,2.5,2.5),coinLogo.rotation.set(.4,0,-.1))}function renderCoin(){coinRenderer&&coinScene&&coinCamera&&coinRenderer.render(coinScene,coinCamera)}function renderJar(){jarRenderer&&jarScene&&jarCamera&&jarRenderer.render(jarScene,jarCamera)}function initScrollAnimations(){gsap.to(coinLogo.position,{x:-70,y:-170,scrollTrigger:{trigger:".hero_home_section",start:"top top",end:"bottom top",scrub:!0,onUpdate:renderCoin}}),gsap.to(coinLogo.rotation,{x:.5*Math.PI,y:2*Math.PI,scrollTrigger:{trigger:".hero_home_section",start:"top top",end:"bottom top",scrub:!0,onUpdate:renderCoin}}),gsap.to(coinLogo.scale,{x:.5,y:.5,z:.5,scrollTrigger:{trigger:".hero_home_section",start:"top top",end:"bottom top",scrub:!0,onUpdate:renderCoin}}),window.innerWidth>991&&gsap.fromTo(coinLogo.position,{x:-70,y:-170},{x:-440,y:-290,scrollTrigger:{trigger:".home_testimonials_section",start:"top bottom",end:"center top",scrub:!0,onUpdate:renderCoin}})}function onResize(){clearTimeout(resizeTimeout),resizeTimeout=setTimeout((()=>{const e=window.innerWidth,o=document.documentElement.clientHeight,n=e/o;if(coinCamera&&coinRenderer&&(coinCamera.aspect=n,coinCamera.updateProjectionMatrix(),coinRenderer.setSize(e,o,!1),renderCoin()),jarCamera&&jarRenderer){const r=1e3;jarCamera.left=r*n/-2,jarCamera.right=r*n/2,jarCamera.top=r/2,jarCamera.bottom=r/-2,jarCamera.updateProjectionMatrix(),jarRenderer.setSize(e,o,!1),renderJar()}window.ScrollTrigger&&ScrollTrigger.refresh()}),150)}window.addEventListener("resize",onResize),window.addEventListener("load",(()=>{initCoinScene(),initJarScene()}));