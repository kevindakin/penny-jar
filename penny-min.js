let coinScene,coinCamera,coinRenderer,coinLogo,jarScene,jarCamera,jarRenderer,jar,resizeTimeout,droppedCoins=[];function initCoinScene(){const e=document.getElementById("coin-canvas");coinScene=new THREE.Scene,coinScene.background=null,coinCamera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,5e3),coinCamera.position.set(0,0,1e3),coinRenderer=new THREE.WebGLRenderer({canvas:e,alpha:!0}),coinRenderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),coinRenderer.setSize(window.innerWidth,window.innerHeight,!1);(new THREE.GLTFLoader).load("https://cdn.jsdelivr.net/gh/kevindakin/penny-jar@v1.06/logo_rev.glb",(e=>{coinLogo=e.scene.getObjectByName("CoinLogo"),coinLogo.traverse((e=>{if(e.isMesh){if("Fill"===e.name)return e.material=new THREE.MeshBasicMaterial({color:6041125,transparent:!0,opacity:0,side:THREE.FrontSide,depthWrite:!0,depthTest:!0}),void(e.renderOrder=0);const r=new THREE.EdgesGeometry(e.geometry,40),t=new THREE.LineSegments(r,new THREE.LineBasicMaterial({color:16249069,transparent:!1,opacity:1,depthTest:!0,depthWrite:!0}));t.renderOrder=1,e.add(t),e.material=new THREE.MeshBasicMaterial({transparent:!0,opacity:0,depthWrite:!1,depthTest:!1,colorWrite:!1})}})),setCoinInitialTransform(),coinScene.add(coinLogo),renderCoin(),initScrollAnimations()}))}function initJarScene(){const e=document.getElementById("jar-canvas");jarScene=new THREE.Scene,jarScene.background=null;const r=window.innerWidth/window.innerHeight,t=1e3;jarCamera=new THREE.OrthographicCamera(t*r/-2,t*r/2,500,-500,.1,5e3),jarCamera.position.set(0,0,1e3),jarRenderer=new THREE.WebGLRenderer({canvas:e,alpha:!0}),jarRenderer.setPixelRatio(Math.min(window.devicePixelRatio,2)),jarRenderer.setSize(window.innerWidth,window.innerHeight,!1);(new THREE.GLTFLoader).load("https://cdn.jsdelivr.net/gh/kevindakin/penny-jar@v1.08/jar_rev.glb",(e=>{jar=e.scene.getObjectByName("Jar");const r=e.scene.getObjectByName("Coins_Instance");r&&(r.position.set(-10,60,0),r.scale.set(.62,.62,.62),r.rotation.set(0,0,0)),jar.traverse((e=>{if(e.isMesh){const r=new THREE.EdgesGeometry(e.geometry,40),t=new THREE.LineSegments(r,new THREE.LineBasicMaterial({color:16249069,opacity:1,transparent:!1,depthTest:!0,depthWrite:!1}));t.renderOrder=999,e.add(t),e.material=new THREE.MeshBasicMaterial({transparent:!0,opacity:0,depthWrite:!1,depthTest:!1,colorWrite:!1})}})),r&&(r.traverse((e=>{if(e.isMesh){if(e.name&&e.name.toLowerCase().includes("fill"))return e.material=new THREE.MeshBasicMaterial({color:6041125,transparent:!1,opacity:1,side:THREE.FrontSide,depthWrite:!0,depthTest:!0}),void(e.renderOrder=0);const r=new THREE.EdgesGeometry(e.geometry,40),t=new THREE.LineSegments(r,new THREE.LineBasicMaterial({color:16249069,opacity:.6,transparent:!1,depthTest:!0,depthWrite:!0}));t.renderOrder=1,e.add(t),e.material=new THREE.MeshBasicMaterial({transparent:!0,opacity:0,depthWrite:!1,depthTest:!1,colorWrite:!1})}})),jar.add(r));const t=new THREE.LineBasicMaterial({color:16249069,transparent:!0,opacity:.8,depthTest:!1,depthWrite:!1}),n=[new THREE.Vector3(-163,45,0),new THREE.Vector3(-163,366,0)],o=[new THREE.Vector3(163,45,0),new THREE.Vector3(163,366,0)],i=(new THREE.BufferGeometry).setFromPoints(n),a=(new THREE.BufferGeometry).setFromPoints(o),s=new THREE.Line(i,t.clone()),c=new THREE.Line(a,t.clone());jar.add(s),jar.add(c),jar.position.set(0,-275,0),jar.scale.set(1.5,1.5,1.5),jar.rotation.set(.15,-.2,0),jarScene.add(jar),renderJar(),window.innerWidth<992?(gsap.to("#jar-canvas",{opacity:0,scrollTrigger:{trigger:".home_centered_section",start:"top top",end:"center+=200 top",scrub:!0}}),gsap.to("#coin-canvas",{opacity:0,scrollTrigger:{trigger:".home_centered_section",start:"top top",end:"center top",scrub:!0}})):(gsap.to(jar.position,{x:-440,y:-440,scrollTrigger:{trigger:".home_testimonials_section",start:"top bottom",end:"center top",scrub:!0,onUpdate:renderJar}}),gsap.to(jar.scale,{x:1.7,y:1.7,z:1.7,scrollTrigger:{trigger:".home_testimonials_section",start:"top bottom",end:"center top",scrub:!0,onUpdate:renderJar}}),gsap.set({},{scrollTrigger:{trigger:".home_testimonials_section",start:"top bottom",end:"bottom top",onLeave:()=>clearDroppedCoins(),onLeaveBack:()=>clearDroppedCoins()}}))}))}function dropCoin(){if(!coinLogo||!jar)return;if(droppedCoins.length>0){const e=droppedCoins[droppedCoins.length-1];e.traverse((e=>{e.isLine&&(e.material.transparent=!0,gsap.to(e.material,{opacity:0,duration:.8,onUpdate:renderJar})),"Fill"===e.name&&e.isMesh&&(e.material.transparent=!0,gsap.to(e.material,{opacity:0,duration:.8,onUpdate:renderJar}))})),gsap.delayedCall(.8,(()=>{jar.remove(e)}))}const e=coinLogo.clone(!0);e.traverse((e=>{(e.isMesh||e.isLine)&&(e.material=e.material.clone(),e.isLine&&(e.material.depthTest=!0)),"Fill"===e.name&&e.isMesh&&(e.material.color.setHex(6041125),e.material.side=THREE.FrontSide,e.material.depthWrite=!0,e.material.depthTest=!0,e.material.transparent=!1,e.material.opacity=1,e.renderOrder=0)})),e.position.set(50*(Math.random()-.5),400,0),e.rotation.set(0,0,0),e.scale.set(.4,.4,.4),jar.add(e),droppedCoins.push(e),gsap.to(e.position,{x:-30,y:173,duration:2,ease:"bounce.out",onUpdate:renderJar}),gsap.to(e.rotation,{x:2.48*Math.PI,y:2.06*Math.PI,duration:2,ease:"power2.out",onUpdate:renderJar})}function clearDroppedCoins(){droppedCoins.forEach((e=>{e.traverse((e=>{e.isLine&&(e.material.transparent=!0,gsap.to(e.material,{opacity:0,duration:.3,onUpdate:renderJar})),"Fill"===e.name&&e.isMesh&&(e.material.transparent=!0,gsap.to(e.material,{opacity:0,duration:.3,onUpdate:renderJar}))})),gsap.delayedCall(.3,(()=>{jar.remove(e)}))})),droppedCoins.length=0}function initSwiperDrops(e,r){if(window.innerWidth<992)return;let t=!1,n=!1;const o=new IntersectionObserver((e=>{e.forEach((e=>{t=e.isIntersecting}))}),{threshold:.3}),i=document.querySelector(".home_testimonials_section");i&&o.observe(i),setTimeout((()=>{e.on("slideChange",(()=>{coinLogo&&t&&!n&&(n=!0,dropCoin(),setTimeout((()=>{n=!1}),2e3))}))}),200)}function setCoinInitialTransform(){if(!coinLogo)return;const e=window.innerWidth;e<768?(coinLogo.position.set(120,-70,0),coinLogo.scale.set(1.4,1.4,1.4),coinLogo.rotation.set(.4,0,-.1)):e<992?(coinLogo.position.set(220,-15,0),coinLogo.scale.set(1.8,1.8,1.8),coinLogo.rotation.set(.4,0,-.1)):(coinLogo.position.set(340,-30,0),coinLogo.scale.set(2.5,2.5,2.5),coinLogo.rotation.set(.4,0,-.1))}function renderCoin(){coinRenderer&&coinScene&&coinCamera&&coinRenderer.render(coinScene,coinCamera)}function renderJar(){jarRenderer&&jarScene&&jarCamera&&jarRenderer.render(jarScene,jarCamera)}function initScrollAnimations(){let e=null;coinLogo.traverse((r=>{"Fill"===r.name&&r.isMesh&&(e=r,r.material.color.setHex(6041125),r.material.transparent=!0,r.material.opacity=0)})),gsap.to(coinLogo.position,{x:-8,y:-25,scrollTrigger:{trigger:".hero_home_section",start:"top top",end:"bottom top",scrub:!0,onUpdate:renderCoin}}),gsap.to(coinLogo.rotation,{x:.52*Math.PI,y:2.1*Math.PI,scrollTrigger:{trigger:".hero_home_section",start:"top top",end:"bottom top",scrub:!0,onUpdate:renderCoin}}),gsap.to(coinLogo.scale,{x:.47,y:.47,z:.47,scrollTrigger:{trigger:".hero_home_section",start:"top top",end:"bottom top",scrub:!0,onUpdate:renderCoin}}),e&&gsap.to(e.material,{opacity:1,scrollTrigger:{trigger:".hero_home_section",start:"top top",end:"bottom top",scrub:!0,onUpdate:renderCoin,onComplete:()=>{e.material.transparent=!1,renderCoin()}}}),window.innerWidth>991&&gsap.fromTo(coinLogo.position,{x:-8,y:-25},{x:-370,y:-134,scrollTrigger:{trigger:".home_testimonials_section",start:"top bottom",end:"center top",scrub:!0,onUpdate:renderCoin}})}function onResize(){clearTimeout(resizeTimeout),resizeTimeout=setTimeout((()=>{const e=window.innerWidth,r=document.documentElement.clientHeight,t=e/r;if(coinCamera&&coinRenderer&&(coinCamera.aspect=t,coinCamera.updateProjectionMatrix(),coinRenderer.setSize(e,r,!1),renderCoin()),jarCamera&&jarRenderer){const n=1e3;jarCamera.left=n*t/-2,jarCamera.right=n*t/2,jarCamera.top=n/2,jarCamera.bottom=n/-2,jarCamera.updateProjectionMatrix(),jarRenderer.setSize(e,r,!1),renderJar()}window.ScrollTrigger&&ScrollTrigger.refresh()}),150)}window.addEventListener("resize",onResize),window.addEventListener("load",(()=>{initCoinScene(),initJarScene()}));